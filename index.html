<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>肖懈谢胁芯写</title>
    <script type="text/javascript">
        var api_file = document.createElement('script');
        api_file.src = 'https://api.ok.ru/js/fapi.js';
        document.head.appendChild(api_file);
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-main: 'Manrope', sans-serif;
            --transition-speed: 0.3s;
            --transition-fast: 0.15s;
            --banner-height: 50px;
            --bg-light: #f5f6fa; --text-light: #4a4a4a; --card-light: #ffffff; --accent-light: #4870ff; --accent-hover-light: #3a59c9; --grid-border-light: #e1e4e8; --selected-light: #dbe4ff; --shadow-light: 0 8px 30px rgba(60, 70, 80, 0.12); --hint-color-light: var(--accent-light);
            --bg-dark: #1d1d1d; --text-dark: #e1e1e1; --card-dark: #2a2a2a; --accent-dark: #5d8aff; --accent-hover-dark: #7d9fff; --grid-border-dark: #3a3a3a; --selected-dark: #313b52; --shadow-dark: 0 8px 30px rgba(0, 0, 0, 0.2); --hint-color-dark: var(--accent-dark);
        }
        html { height: 100%; }
        body {
            font-family: var(--font-main); margin: 0; padding: 0; box-sizing: border-box;
            background-color: var(--bg-color); color: var(--text-color);
            transition: background-color var(--transition-speed), color var(--transition-speed);
            overflow: hidden; user-select: none; -webkit-user-select: none;
            touch-action: none; -webkit-tap-highlight-color: transparent; height: 100%;
            padding-bottom: var(--banner-height);
        }
        body[data-theme='light'] { --bg-color: var(--bg-light); --text-color: var(--text-light); --card-color: var(--card-light); --accent-color: var(--accent-light); --accent-hover-color: var(--accent-hover-light); --grid-border-color: var(--grid-border-light); --selected-color: var(--selected-light); --text-selected-color: #2c3e50; --box-shadow: var(--shadow-light); --hint-color: var(--hint-color-light); }
        body[data-theme='dark'] { --bg-color: var(--bg-dark); --text-color: var(--text-dark); --card-color: var(--card-dark); --accent-color: var(--accent-dark); --accent-hover-color: var(--accent-hover-dark); --grid-border-color: var(--grid-border-dark); --selected-color: var(--selected-dark); --text-selected-color: #e1e1e1; --box-shadow: var(--shadow-dark); --hint-color: var(--hint-color-dark); }
        .screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; padding: 1rem; box-sizing: border-box; opacity: 0; transform: scale(0.98); transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease; pointer-events: none; }
        .screen.active { opacity: 1; transform: scale(1); pointer-events: auto; }
        #main-menu { justify-content: center; gap: 4vh; padding-top: 1rem; padding-bottom: 1rem; overflow-y: auto; }
        #main-menu .title { font-size: clamp(2.2rem, 9vh, 4rem); font-weight: 800; color: var(--accent-color); margin: 0; line-height: 1; flex-shrink: 0; }
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: clamp(0.5rem, 2vh, 1rem); width: 100%; max-width: 320px; flex-shrink: 0; }
        .menu-button { position: relative; background-color: var(--card-color); color: var(--text-color); border: none; border-radius: 16px; padding: clamp(0.7rem, 2.5vh, 1.2rem) 1rem; font-size: clamp(1.2rem, 4vh, 1.5rem); font-weight: 700; cursor: pointer; transition: all var(--transition-speed); box-shadow: var(--box-shadow); text-align: center; overflow: hidden; }
        .menu-button:not(:disabled):hover { transform: translateY(-6px); box-shadow: 0 12px 35px rgba(60, 70, 80, 0.15); }
        body[data-theme='dark'] .menu-button:not(:disabled):hover { box-shadow: 0 12px 35px rgba(0, 0, 0, 0.25); }
        .menu-button:disabled { cursor: not-allowed; opacity: 0.6; }
        .menu-button .level-info { font-size: clamp(0.7rem, 1.5vh, 0.9rem); font-weight: 400; opacity: 0.6; margin-top: 5px; }
        .lock-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.3); display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; backdrop-filter: blur(2px); opacity: 0; pointer-events: none; transition: opacity var(--transition-speed); }
        .menu-button.locked .lock-overlay { opacity: 1; }
        .lock-icon { font-size: 2rem; }
        .unlock-progress { font-size: 0.9rem; font-weight: 600; margin-top: 0.5rem; }
        .bottom-buttons-container { display: flex; gap: 1rem; margin-top: 1rem; flex-shrink: 0; }
        .bottom-button { background-color: var(--card-color); border: 1px solid var(--grid-border-color); color: var(--text-color); padding: 0.8rem 1.5rem; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all var(--transition-speed); }
        .bottom-button:hover { transform: translateY(-3px); box-shadow: var(--box-shadow); }
        #game-screen { justify-content: flex-start; padding-top: 2rem; }
        .grid-wrapper { flex-grow: 1; width: 100%; display: flex; align-items: center; justify-content: center; }
        .game-header { width: 100%; max-width: 500px; display: flex; justify-content: space-between; align-items: center; padding: 0 5px; margin-bottom: 1rem; }
        .game-header-button { background-color: var(--card-color); border: 1px solid var(--grid-border-color); color: var(--text-color); padding: 0.6rem 1.2rem; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all var(--transition-speed); display: flex; align-items: center; gap: 0.5rem; }
        .game-header-button:hover { transform: translateY(-3px); box-shadow: var(--box-shadow); border-color: var(--accent-color); }
        .game-header-button:disabled { opacity: 0.5; cursor: not-allowed; }
        .level-display { font-size: 1.5rem; font-weight: 700; color: var(--accent-color); }
        #grid-container { display: grid; gap: 6px; width: 90vw; max-width: 500px; user-select: none; }
        .grid-cell { aspect-ratio: 1 / 1; display: flex; align-items: center; justify-content: center; background-color: var(--card-color); border: 1px solid transparent; border-radius: 12px; font-size: clamp(1rem, 5vw, 2rem); font-weight: 700; text-transform: uppercase; color: var(--text-color); transition: all var(--transition-fast); cursor: pointer; }
        .grid-cell.selected { background-color: var(--selected-color); color: var(--text-selected-color); transform: scale(0.9); border-color: var(--accent-color); }
        .grid-cell.found { color: #fff; box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.4); }
        .grid-cell.hint { animation: hint-pulse 1s ease-in-out; }
        @keyframes hint-pulse { 0% { box-shadow: inset 0 0 0 0px var(--hint-color); } 50% { box-shadow: inset 0 0 0 4px var(--hint-color); } 100% { box-shadow: inset 0 0 0 0px var(--hint-color); } }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity var(--transition-speed); z-index: 1000; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content { background-color: var(--card-color); padding: 2rem; border-radius: 20px; text-align: center; box-shadow: var(--box-shadow); transform: scale(0.8); transition: transform var(--transition-speed) ease-out; width: 90%; max-width: 380px; }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .modal-content h2 { font-size: 2.2rem; font-weight: 800; color: var(--accent-color); margin-top: 0; margin-bottom: 0.5rem; }
        .modal-content p { font-size: 1.1rem; margin-bottom: 1.5rem; opacity: 0.8; line-height: 1.5; text-align: left;}
        .modal-buttons { display: flex; flex-direction: column; gap: 0.8rem; }
        .modal-button { background-color: var(--accent-color); color: white; border: none; border-radius: 12px; padding: 1rem; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: all var(--transition-speed); width: 100%; }
        .modal-button:hover { background-color: var(--accent-hover-color); transform: scale(1.05); }
        .modal-button.secondary { background-color: transparent; color: var(--accent-color); border: 2px solid var(--grid-border-color); }
        .modal-button.secondary:hover { background-color: var(--grid-border-color); }
        .rules-illustration { display: flex; justify-content: center; margin-bottom: 1.5rem; }
        .illustration-grid { display: grid; grid-template-columns: repeat(3, 40px); gap: 4px; }
        .illustration-cell { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background-color: var(--grid-border-color); border-radius: 8px; font-weight: 700; font-size: 1.5rem; }
        .illustration-cell.highlighted { background-color: var(--accent-color); color: white; }
        .toast-notification { position: fixed; bottom: 20%; left: 50%; transform: translateX(-50%); background-color: rgba(0, 0, 0, 0.7); color: white; padding: 12px 20px; border-radius: 25px; font-size: 1rem; font-weight: 600; z-index: 2000; opacity: 0; transition: opacity 0.4s ease, transform 0.4s ease; pointer-events: none; }
        .toast-notification.show { opacity: 1; transform: translate(-50%, -20px); }
    </style>
</head>
<body>
    <div id="ok_api_transport"></div>
    <div id="app-container">
        <div id="main-menu" class="screen active">
            <h1 class="title">肖懈谢胁芯写</h1>
            <div class="menu-grid">
                <button class="menu-button" data-size="5">5 x 5<div class="level-info" id="level-info-5"></div></button>
                <button class="menu-button" data-size="6"><div class="button-content">6 x 6<div class="level-info" id="level-info-6"></div></div><div class="lock-overlay"><span class="lock-icon"></span><span class="unlock-progress" id="unlock-progress-6"></span></div></button>
                <button class="menu-button" data-size="7"><div class="button-content">7 x 7<div class="level-info" id="level-info-7"></div></div><div class="lock-overlay"><span class="lock-icon"></span><span class="unlock-progress" id="unlock-progress-7"></span></div></button>
                <button class="menu-button" data-size="8"><div class="button-content">8 x 8<div class="level-info" id="level-info-8"></div></div><div class="lock-overlay"><span class="lock-icon"></span><span class="unlock-progress" id="unlock-progress-8"></span></div></button>
            </div>
            <div class="bottom-buttons-container">
                <button id="rules-button" class="bottom-button">邪胁懈谢邪</button>
                <button id="theme-toggle" class="bottom-button">小屑械薪懈 械屑</button>
            </div>
        </div>
        <div id="game-screen" class="screen">
            <div class="game-header">
                <button class="game-header-button" id="pause-button"></button>
                <div id="level-display" class="level-display"></div>
                <button class="game-header-button" id="hint-button"> 讹</button>
            </div>
            <div class="grid-wrapper"><div id="grid-container"></div></div>
        </div>
    </div>
    <div id="win-modal" class="modal-overlay"><div class="modal-content"><h2>谢懈薪芯!</h2><p>校芯胁械薪 锌芯泄写械薪!</p><div class="modal-buttons"><button id="next-level-button" class="modal-button">小谢械写懈泄</button><button id="win-menu-button" class="modal-button secondary"> 屑械薪</button></div></div></div>
    <div id="pause-modal" class="modal-overlay"><div class="modal-content"><h2>邪蟹邪</h2><div class="modal-buttons"><button id="resume-button" class="modal-button">芯写芯谢卸懈</button><button id="pause-menu-button" class="modal-button secondary">泄懈 胁 屑械薪</button></div></div></div>
    <div id="rules-modal" class="modal-overlay"><div class="modal-content"><h2>邪胁懈谢邪 懈谐</h2><p>邪泄写懈械 胁械 谢芯胁邪, 锌邪薪薪械 胁 械泻械. 小谢芯胁邪 屑芯谐 懈蟹谐懈斜邪 胁 谢斜芯屑 薪邪锌邪胁谢械薪懈懈, 薪芯 薪械 锌械械械泻邪.</p><p>效芯斜 胁写械谢懈 谢芯胁芯, 锌芯胁械写懈械 锌邪谢械屑 懈谢懈 屑 锌芯 斜泻胁邪屑 芯 薪邪邪谢邪 写芯 泻芯薪邪.</p><div class="rules-illustration"><div class="illustration-grid"><div class="illustration-cell"></div><div class="illustration-cell highlighted"></div><div class="illustration-cell"></div><div class="illustration-cell"></div><div class="illustration-cell highlighted"></div><div class="illustration-cell"></div><div class="illustration-cell"></div><div class="illustration-cell highlighted">孝</div><div class="illustration-cell"></div></div></div><div class="modal-buttons"><button id="close-rules-button" class="modal-button">芯薪薪芯</button></div></div></div>


  <script>
    // --- OK SDK: 斜械泻邪 写谢 邪懈薪芯薪薪芯泄 懈薪懈懈邪谢懈蟹邪懈懈 ---
    function initOKSDK() {
        return new Promise((resolve) => {
            const onOdnoklassnikiLoaded = () => {
                const params = FAPI.Util.getRequestParameters();
                FAPI.init(params.api_server, params.apiconnection, () => {
                    console.log('OK SDK initialized.');
                    resolve(params);
                }, (error) => {
                    console.error('OK SDK init error:', error);
                    resolve(null); // 械邪械屑 锌芯屑懈 写邪卸械 锌懈 芯懈斜泻械, 芯斜 懈谐邪 蟹邪锌懈谢邪
                });
            };
            // 芯斜邪胁谢械屑 芯斜邪斜芯懈泻 胁 谐谢芯斜邪谢薪 芯斜谢邪 胁懈写懈屑芯懈
            window.OK_API_init_success = onOdnoklassnikiLoaded;
        });
    }

    window.addEventListener('load', async () => {
        // --- 蝎 ---
        let FAPI_PARAMS = null;
        let levelsPlayedSinceAd = 0;
        const LEVELS_TO_UNLOCK = 30;
        const INTERSTITIAL_AD_FREQUENCY = 2;
        let gameState = { levels: { 5: 1, 6: 1, 7: 1, 8: 1 }, theme: 'light' };
        const wordsDB = {
            4: ["", "", "", "", "鞋", "", "孝", "蝎鞋", "些鞋", "", "", "校小", "", "携", "",
"效", "啸", "", "", "啸", "校", "", "效", "", "", "鞋", "", "携", "效鞋", "校", "校", "校楔", "携携", "", "校", "", "",
"", "", "携", "孝", "挟鞋", "挟鞋", "", "校", "挟效", "", "鞋", "肖", "", "", "校小", "校小孝", "孝", "小孝", "笑", "", "孝鞋", "",
"孝", "", "", "", "小孝", "携小", "", "", "效鞋", "", "", "蝎孝", "孝笑", "效", "", "", "", "", "", "", "协孝", "校孝鞋",
"", "小", "鞋", "校", "蝎", "小", "小", "小鞋", "小孝鞋", "小", "小校啸", "小啸", "小", "小挟", "小", "小", "小孝啸", "小孝", "小孝校", "小校孝鞋", "小效孝", "孝",
"孝", "孝", "孝鞋", "孝孝携", "孝校", "校", "校", "校小", "校", "校孝", "校啸", "校效孝", "肖孝", "肖", "啸", "啸", "笑鞋", "笑孝", "笑鞋", "笑", "效孝", "效",
"效校", "楔小", "楔孝", "楔孝孝", "些", "协孝", "协孝", "携蝎", "携些"],
            5: ["孝", "笑", "孝", "小", "挟", "", "孝", "孝", "孝", "", "小", "孝", "孝", "",
    "", "孝", "校", "笑", "笑携", "", "楔", "啸", "携", "", "", "", "", "", "", "", "", "", "", "",
    "", "小", "孝", "校", "", "", "", "小孝", "携", "啸", "楔", "小孝", "小孝", "孝", "孝小", "孝孝", "校", "校孝", "肖", "肖楔",
    "", "", "", "孝", "鞋携", "", "小", "", "", "孝", "", "蝎", "", "", "", "", "", "", "", "",
    "", "小携", "孝", "孝校孝", "效", "楔", "楔携", "校", "", "", "", "", "", "鞋", "携楔", "", "", "孝", "", "",
    "孝", "", "", "", "", "小", "孝", "孝", "孝校", "孝鞋", "", "鞋", "", "小", "鞋", "啸", "校", "挟", "携啸", "",
    "效", "校", "", "", "携", "", "", "", "校小", "笑", "小携", "孝", "孝", "效", "效", "鞋", "小小", "携", "", "楔鞋",
    "鞋", "鞋", "携", "楔鞋", "协", "挟", "挟啸", "校", "校", "校", "校", "校", "校", "校", "校孝", "校", "校", "校", "校", "校孝",
    "校孝", "校肖", "校肖孝", "校啸孝", "蝎", "蝎孝", "蝎效", "", "孝", "", "校", "校", "鞋小", "", "", "", "携", "孝", "孝",
    "肖携", "啸孝", "小", "", "", "校", "笑", "", "", "鞋", "", "肖鞋", "小", "小", "孝鞋", "孝", "孝", "孝", "效", "",
    "", "啸", "孝", "", "啸", "小", "蝎", "蝎小", "", "孝", "", "", "校小", "小", "小", "孝鞋", "啸鞋", "楔携", "", "",
    "", "", "", "鞋", "携", "", "", "", "小", "啸", "鞋孝", "鞋", "", "孝", "啸", "楔", "携", "", "孝", "携",
    "小啸", "校鞋", "歇", "蝎", "蝎啸", "蝎", "蝎", "蝎", "蝎校", "蝎", "蝎啸", "蝎", "蝎", "蝎", "蝎小", "蝎校", "蝎", "蝎孝", "蝎小", "蝎",
    "蝎", "蝎校", "蝎小", "蝎啸", "蝎效孝", "蝎楔", "鞋挟", "携孝", "", "", "", "", "", "", "", "", "", "", "孝蝎", "孝孝",
    "", "", "", "鞋", "", "小孝", "校鞋", "校楔鞋", "蝎", "鞋", "", "小", "鞋肖", "笑", "", "", "笑", "", "", "",
    "啸", "小孝鞋", "", "鞋", "", "鞋", "", "", "校鞋", "校孝", "校楔", "蝎", "携鞋", "校", "校", "校携楔", "校小", "", "", "",
    "孝小", "鞋", "孝", "挟孝", "", "", "", "", "", "", "笑", "", "孝", "肖小", "", "", "孝", "", "小", "鞋",
    "", "些", "挟啸", "", "", "", "鞋", "", "", "", "", "", "小", "小", "小校", "小鞋", "啸", "效", "", "",
    "", "", "蝎", "鞋", "肖孝", "鞋", "", "", "校", "校", "校鞋", "校", "校", "校", "校楔", "校协鞋", "蝎", "蝎", "蝎", "蝎",
    "蝎楔", "挟楔小", "携孝", "", "鞋", "", "小鞋", "楔", "", "孝", "孝", "孝", "效鞋", "啸", "鞋", "", "小孝鞋", "孝", "孝", "鞋",
    "孝", "笑", "", "鞋", "肖", "", "笑", "校", "校效", "", "", "", "", "孝", "", "", "校效", "", "", "",
    "", "", "", "蝎", "", "", "", "", "孝", "", "", "校", "", "啸", "小", "", "小", "", "小", "啸",
    "", "", "校", "携", "小", "小", "小", "孝", "孝", "效孝", "", "鞋", "", "", "鞋", "携", "孝", "", "肖", "携",
    "", "", "", "孝", "", "", "", "", "", "小", "歇携", "蝎小", "", "孝", "", "校楔", "校小", "挟", "", "校",
    "", "小", "小", "小校", "小孝笑", "小孝", "小啸", "", "", "", "", "蝎", "", "", "啸", "", "鞋", "校小", "", "效",
    "", "", "", "蝎楔", "", "孝", "", "协", "校", "携", "孝", "", "孝", "", "", "", "孝", "小", "小", "小小",
    "小孝", "孝", "孝孝", "孝", "孝", "孝蝎楔", "肖", "效", "楔", "挟孝", "孝", "", "笑", "小孝", "孝", "", "携", "", "肖", "小",
    "", "", "小孝", "小", "小孝", "小孝鞋", "肖", "楔", "鞋", "小小", "", "些", "楔", "校", "校楔", "携效", "", "携鞋", "", "鞋",
    "", "", "", "校啸", "", "蝎", "", "", "孝", "", "小", "", "携", "小", "", "", "", "", "", "笑",
    "校小", "挟啸", "携", "鞋", "", "", "", "", "小孝鞋", "小携", "孝", "孝", "孝蝎", "肖孝", "效", "效", "楔", "些", "", "小",
    "肖孝", "小孝", "鞋", "", "啸", "校", "校", "蝎", "蝎小", "蝎楔", "小", "校", "校", "校", "校", "校楔", "校", "校", "校", "校",
    "校效", "校", "校鞋孝", "校", "校蝎小", "校", "校笑", "校", "校", "校", "校", "校小", "校啸携", "挟孝", "楔", "", "", "鞋携", "", "",
    "", "", "", "孝", "楔", "", "笑", "小", "小小", "楔", "", "", "校", "孝", "小", "楔", "", "", "", "",
    "孝", "", "肖", "", "携", "笑", "孝", "孝鞋", "笑", "", "笑", "", "", "", "", "", "校啸", "孝", "孝小", "校",
    "校", "校", "校效", "蝎携", "挟", "挟校小", "挟孝", "挟孝携", "挟效", "携", "携", "携", "", "", "", "", "", "", "校孝", "",
    "孝", "", "笑", "蝎楔", "携", "", "", "", "", "携", "", "", "", "携", "小", "小", "小小", "小孝鞋", "孝", "肖携",
    "", "", "携", "", "", "小孝", "小孝鞋", "小携笑", "孝", "孝", "孝", "孝", "孝", "效孝", "楔", "携", "", "小", "楔", "",
    "", "", "携", "啸", "", "", "携", "孝", "孝", "孝", "效", "校", "校", "校携", "校携", "校小", "校肖孝", "校楔", "蝎小鞋", "蝎楔",
    "蝎楔笑", "协携", "挟小", "携孝", "携效", "", "", "小", "", "蝎", "", "孝", "", "", "", "蝎", "", "蝎", "携", "小小",
    "小蝎", "孝携", "校", "啸", "笑携", "效小", "", "校", "笑", "", "笑", "", "肖孝鞋", "孝", "", "", "蝎", "", "", "",
    "小效", "小", "小", "小", "孝", "效", "校", "校", "校孝", "蝎孝", "蝎孝鞋", "挟小", "挟啸效", "携楔", "小", "", "小", "", "", "",
    "", "", "", "", "", "", "", "校效", "蝎", "携", "校鞋", "啸", "歇", "蝎小", "", "鞋", "", "", "", "校",
    "小", "孝", "鞋", "", "", "鞋啸", "孝", "", "孝", "小鞋", "", "小", "校小", "笑携", "", "", "", "", "小", "小鞋",
    "小孝", "小", "小", "小", "小", "小鞋", "小", "孝", "孝", "孝", "孝孝", "孝", "孝", "孝", "孝", "孝蝎啸", "孝鞋", "孝", "孝蝎", "孝",
    "孝孝", "孝", "孝啸", "孝", "孝", "孝", "孝", "孝校", "孝蝎", "孝携", "孝小", "孝啸", "孝效孝", "啸孝", "啸孝", "", "校", "", "孝", "效",
    "笑", "", "", "", "", "", "", "孝", "校小", "小孝", "小啸", "校", "笑", "效", "笑", "小", "", "", "", "",
    "", "", "笑", "小孝", "小笑", "小", "小携", "小", "孝校啸", "效", "楔", "", "孝", "", "孝", "", "孝", "孝", "", "",
    "小笑", "孝", "啸孝", "笑笑", "鞋", "携", "孝", "孝", "携", "小", "效", "孝", "孝鞋", "", "", "", "", "", "", "",
    "", "", "小", "", "", "", "", "", "小", "孝", "", "小", "", "挟小", "携", "孝", "", "", "效", "",
    "", "", "", "", "啸", "孝蝎", "效", "蝎", "小", "小", "小啸", "小蝎", "孝", "孝", "啸", "效", "效孝", "效", "效孝", "楔",
    "协", "", "", "小小", "", "笑", "挟孝", "", "", "", "", "肖", "校小小", "携", "携啸", "小鞋", "孝啸", "孝笑", "校孝", "校效",
    "校", "校效", "校鞋小", "校鞋孝", "校孝", "校", "校", "校肖", "校效", "校楔", "校楔", "效", "楔", "蝎", "蝎孝", "蝎楔", "鞋小", "鞋携鞋", "携孝", "",
    "", "", "", "校", "", "", "", "", "笑", "", "效", "校", "啸孝", "笑携", "效", "孝", "", "校小", "校", "",
    "", "小", "", "携", "校小", "鞋小", "", "", "", "孝", "效", "楔", "", "肖", "孝", "携", "效", "", "", "",
    "效", "携", "", "", "鞋", "孝", "", "", "孝", "孝", "啸携", "携鞋", "孝校孝鞋", "校", "校笑", "校", "校", "校鞋", "校鞋", "校",
    "校", "校孝", "校", "校", "校小", "校效", "校效", "蝎", "蝎", "蝎", "蝎", "蝎效", "协", "挟", "挟楔", "携小", "小", "小", "小", "小",
    "小孝", "小", "小", "小挟孝", "小", "小笑", "小", "小", "小", "小", "小校", "小啸", "小效", "小", "小小", "小校携", "小啸", "小效", "小小孝", "小孝",
    "小", "小携鞋", "小", "小效", "小", "小小", "小", "小校", "小", "小", "小", "小效", "小孝", "小肖", "小", "小鞋携", "小孝", "小携", "小孝", "小",
    "小", "小", "小校小", "小携", "小", "小肖", "小", "小校孝", "小", "小楔", "小孝", "小", "小", "小", "小", "小孝效", "小", "小校", "小校小", "小",
    "小", "小", "小", "小", "小鞋", "小", "小校", "小挟", "小挟", "小", "小效", "小小鞋", "小孝", "小", "小蝎小", "小", "小孝", "小", "小", "小蝎",
    "小", "小", "小", "小", "小携", "小", "小校", "小小", "小小", "小小", "小小校", "小孝", "小孝携", "小小鞋", "小", "小孝", "小笑", "小", "小", "小孝",
    "小小", "小校孝", "小校小", "小", "小小", "小小校", "小孝", "小孝鞋", "小孝孝", "小孝", "小孝", "小孝携", "小孝", "小孝", "小孝小", "小孝", "小孝", "小孝鞋", "小孝鞋", "小孝啸",
    "小孝", "小孝", "小孝", "小孝携", "小孝", "小孝啸", "小孝", "小孝孝", "小孝", "小孝校携", "小孝校", "小校", "小校", "小校鞋携", "小校孝", "小校", "小校", "小校", "小校小", "小校孝",
    "小校肖", "小校效", "小校楔", "小肖", "小啸", "小笑", "小效孝蝎", "小歇", "小蝎", "小蝎", "小蝎鞋", "小蝎些", "小挟孝", "孝", "孝", "孝", "孝校", "孝", "孝", "孝",
    "孝小", "孝小", "孝", "孝携", "孝", "孝", "孝笑", "孝小", "孝", "孝肖", "孝小", "孝效", "孝小孝", "孝孝", "孝小", "孝小孝", "孝", "孝笑", "孝", "孝",
    "孝", "孝", "孝", "孝小", "孝小", "孝小孝", "孝小孝鞋", "孝啸", "孝", "孝", "孝", "孝", "孝小", "孝孝", "孝孝校", "孝鞋", "孝", "孝", "孝些", "孝孝",
    "孝", "孝", "孝", "孝校小", "孝", "孝", "孝", "孝孝", "孝笑", "孝", "孝小", "孝孝", "孝效", "孝", "孝孝", "孝小", "孝小孝", "孝孝", "孝校", "孝鞋",
    "孝", "孝小", "孝小孝", "孝孝鞋", "孝", "孝", "孝", "孝", "孝携", "孝校", "孝校小蝎", "孝校啸", "孝校校小", "孝校", "孝校校", "孝校", "孝校", "孝校笑", "孝校", "孝校",
    "孝校肖携", "孝校效", "孝蝎", "孝蝎效", "孝挟", "孝挟", "孝挟肖携", "孝携效", "孝携", "孝携", "校鞋", "校鞋", "校效", "校", "校", "校", "校", "校小校小", "校", "校笑",
    "校", "校", "校", "校蝎鞋", "校小啸", "校小孝", "校小孝校", "校孝携", "校孝啸", "校孝鞋", "校啸孝", "校效", "校些", "肖", "肖", "肖", "肖孝", "肖小", "肖小", "肖校",
    "肖携小", "肖鞋", "肖", "肖小", "肖", "肖", "肖校小", "肖鞋", "肖", "肖", "肖楔", "肖", "肖楔", "肖", "肖孝", "肖", "肖挟", "肖携", "肖携", "肖校小",
    "肖", "肖挟", "肖", "肖校", "肖孝", "肖", "肖", "肖", "肖", "肖孝", "肖校孝", "肖校小", "肖校", "肖校", "肖鞋", "啸", "啸", "啸孝", "啸", "啸",
    "啸效", "啸鞋", "啸小孝", "啸携", "啸", "啸携", "啸", "啸孝", "啸孝", "啸小孝", "啸蝎小孝", "啸鞋", "啸蝎鞋", "啸", "啸孝", "啸", "啸", "啸", "啸校", "啸",
    "啸", "啸", "啸小孝", "啸校孝", "啸携", "啸", "啸", "啸", "啸啸", "啸啸", "啸啸孝", "啸校小孝", "啸携", "啸校", "啸校孝", "笑", "笑携", "笑笑", "笑鞋", "笑",
    "笑", "笑", "笑孝", "笑", "笑", "笑", "笑", "笑", "笑肖", "笑孝", "笑校孝", "笑蝎", "效", "效", "效小", "效小孝鞋", "效楔", "效", "效蝎", "效鞋",
    "效", "效", "效鞋", "效孝", "效小孝鞋", "效啸", "效楔校携", "效小", "效", "效小蝎", "效小", "效孝", "效", "效", "效孝", "效校楔", "效校校", "效校", "效校", "效校",
    "效校", "效校", "效校效", "效校", "效校", "效校", "效校", "效校孝鞋", "效校楔", "楔", "楔", "楔", "楔", "楔楔", "楔校", "楔", "楔", "楔", "楔小小", "楔小小",
    "楔孝", "楔孝", "楔肖", "楔啸孝", "楔楔", "楔鞋", "楔", "楔孝", "楔肖", "楔", "楔", "楔孝鞋", "楔肖", "楔楔", "楔", "楔", "楔", "楔校", "楔", "楔肖",
    "楔肖孝", "楔携", "楔鞋", "楔小", "楔携", "楔", "楔啸", "楔孝蝎", "楔小小", "楔肖", "楔", "楔", "楔", "楔鞋", "楔", "楔", "楔", "楔笑", "楔孝", "楔肖孝",
    "楔孝", "楔孝", "楔孝", "楔孝蝎", "楔孝鞋", "楔孝肖孝", "楔孝", "楔孝", "楔孝肖", "楔孝啸", "楔孝校", "楔孝校", "楔孝蝎鞋", "楔校", "楔校", "楔校", "楔校校", "楔校孝", "楔校啸", "楔啸校",
    "些孝", "些", "些", "些", "些", "些孝", "些效", "些", "些孝", "协", "协", "协", "协楔", "协孝", "协孝", "协鞋", "协孝", "协啸", "协啸", "协挟",
    "协笑", "协小", "协小孝孝", "协孝", "协孝小", "协肖", "挟", "挟", "挟楔", "挟小孝", "携", "携", "携校", "携效", "携鞋", "携些", "携蝎", "携校", "携蝎", "携小鞋",
    "携小孝"],
            6: ["校", "小校", "携", "", "校小孝", "", "鞋", "孝小孝", "小", "小", "鞋", "校",
"挟孝", "挟", "小携", "携", "小孝鞋", "校效", "校啸", "小", "小", "孝", "小孝", "蝎蝎", "蝎", "蝎校小", "蝎小孝", "孝", "", "",
"", "啸孝", "校", "蝎", "笑", "鞋", "", "孝鞋", "", "孝", "", "", "校", "校", "孝", "孝鞋", "校", "孝",
"效", "小鞋", "些孝", "", "", "", "", "孝", "", "", "携孝", "", "鞋", "", "", "孝", "孝", "",
"小", "", "小", "鞋笑", "孝", "效", "鞋携", "鞋", "鞋", "校小", "小孝挟", "小", "孝", "小", "小", "鞋", "鞋", "",
"效", "楔鞋", "挟鞋", "小孝", "小孝孝", "孝鞋", "楔", "孝", "校孝", "", "鞋", "", "孝", "校蝎", "效", "携", "携鞋", "歇孝",
"", "些", "", "", "孝", "孝", "校", "小", "小孝", "肖笑", "啸", "笑", "楔", "孝", "携孝鞋", "鞋", "孝携", "小携",
"", "效孝鞋", "小鞋", "孝鞋", "", "啸", "小", "鞋", "些鞋", "孝携", "协携", "", "", "携", "", "", "", "",
"孝", "孝", "", "孝", "小啸", "小效孝", "携孝", "", "孝", "小校小", "", "小", "小笑", "小小孝", "小校啸", "小", "小", "小",
"小校", "小校效", "小孝鞋", "小", "小孝", "小笑", "小小孝", "小小", "小小", "小孝", "小孝", "小孝", "小孝孝校小", "小孝孝鞋携", "小孝", "小孝", "小孝", "小孝",
"小校鞋", "小校孝携", "小校笑", "孝孝", "孝携", "孝楔", "孝肖", "孝啸", "孝校效", "孝校", "孝蝎小携效", "孝挟鞋", "校", "校蝎", "校小", "校小校", "校效", "校效蝎",
"肖孝", "肖校", "肖", "肖", "啸携", "笑孝", "笑孝", "笑", "笑", "效孝", "楔孝", "楔", "协孝", "协", "协", "协孝孝", "协肖肖孝", "携",
"携鞋", "携小孝", "携小孝"],
            7: ["孝校小", "孝孝", "孝", "校楔", "鞋", "鞋", "校校些", "校孝蝎", "孝", "楔", "携",
"小孝", "小孝", "小孝效", "", "", "校", "小鞋", "笑", "效", "校楔", "鞋", "校孝孝", "携", "小携孝", "孝小孝", "",
"蝎啸", "笑", "", "些", "携孝", "小", "孝孝", "", "孝鞋", "", "", "孝小", "小孝携", "孝", "孝", "孝",
"孝", "", "", "孝孝", "孝", "校小", "孝孝", "笑孝", "鞋", "", "小孝", "孝鞋", "", "鞋效", "小楔孝", "笑携",
"", "小孝", "小效", "校效", "", "效", "小孝鞋", "小孝鞋", "", "笑", "些", "孝携鞋", "小孝孝", "孝效", "孝小鞋", "效鞋",
"孝", "", "啸", "些鞋", "孝", "", "校", "歇", "", "笑携", "携孝", "蝎孝", "孝孝", "携", "小", "小孝鞋",
"孝", "", "孝", "", "笑", "", "效", "", "校孝", "小鞋", "笑孝", "笑小小", "楔", "校", "效", "小孝鞋",
"笑", "小小", "笑携", "", "", "肖", "楔", "小校", "校小小", "小孝", "小", "小校", "小小孝", "小蝎孝", "小小孝鞋", "小孝笑携",
"小孝校啸", "小孝鞋", "小孝笑", "小孝", "小孝小孝鞋", "小孝校孝", "小校歇孝", "小效小孝鞋", "孝笑", "孝肖", "孝孝", "孝啸", "孝效", "孝些", "校鞋", "校小",
"校效小孝", "校效小孝", "校效孝鞋", "肖携", "肖鞋", "肖校", "肖校笑携", "啸携", "笑鞋", "效", "效校小孝", "协小孝", "协孝", "协携", "携"],
            8: ["携", "鞋笑", "效", "些小孝", "笑", "", "孝鞋", "蝎小孝", "小", "",
"", "小孝", "孝", "校孝", "孝", "孝", "鞋", "蝎", "效", "小孝", "校效", "小孝孝校孝", "小孝效", "孝", "效小孝",
"孝", "孝", "", "小小携", "携", "小", "孝鞋", "肖孝", "校鞋孝校", "小孝笑", "效小孝鞋", "孝", "啸", "鞋", "些小孝鞋",
"", "校效", "些小孝", "", "笑携", "小", "", "小", "孝蝎孝", "些校些", "携孝", "孝", "效", "小孝鞋", "小孝孝",
"些", "孝", "", "些", "", "孝", "孝", "携孝", "携孝鞋", "", "", "校", "孝", "孝", "",
"小孝", "孝", "笑携", "小小", "小孝", "孝鞋", "", "小", "小小孝", "小孝携鞋", "小", "小孝", "小孝校笑携", "小小孝鞋", "小",
"小", "小", "小", "小", "小小孝", "小孝笑", "小校些小孝", "小校些小孝鞋", "孝携", "孝笑携", "校小孝", "校", "校效小孝", "啸孝", "啸校",
"笑小孝鞋", "效", "效孝孝鞋"],
            9: ["孝小肖", "蝎", "小孝笑", "", "孝鞋", "小孝鞋", "校小孝", "小", "携",
"", "校些小孝", "小校小小孝", "小蝎孝", "孝携", "孝", "校小孝", "鞋挟孝", "笑笑携", "孝孝", "鞋效楔", "", "小孝", "小孝蝎鞋",
"校楔", "小", "效鞋", "孝", "些", "效", "小小孝鞋", "小", "孝", "孝楔", "", "蝎楔", "", "",
"", "", "校效", "些", "", "携", "孝", "", "", "校笑携", "孝", "肖小小携", "肖小小", "笑校",
"挟笑携", "校鞋孝孝", "小孝鞋", "小孝鞋", "小小孝", "小", "小些", "小小孝携", "小孝校", "小效", "小孝鞋", "小", "小孝小孝鞋", "小孝校孝校",
"孝", "孝笑携", "孝小孝", "校", "校小孝", "肖笑携", "肖小肖携", "啸携小孝", "效小孝小孝鞋", "效孝", "协"],
            10: ["孝鞋", "孝小孝鞋", "笑", "孝", "小孝", "蝎", "校孝", "小孝", "挟效",
"笑孝", "小孝校孝", "肖笑携", "小挟效", "小", "效小孝", "孝孝校", "挟", "效", "小孝", "效鞋小孝", "小孝孝", "小孝",
"歇携小", "孝小校孝小孝", "蝎", "孝", "孝鞋", "校孝鞋", "", "", "小啸携", "孝", "楔", "小小孝携", "笑携",
"鞋小孝鞋", "小校", "小楔", "小", "小", "小笑小孝", "孝效小孝", "孝孝携", "孝啸携", "孝", "校效", "校", "校小孝小孝",
"校效", "肖孝肖携"],
            11: ["鞋楔小孝", "些", "小孝", "小孝鞋", "效孝", "蝎小孝校", "小校小孝", "小孝小孝",
"小小孝鞋", "小孝孝鞋", "", "小孝校笑携", "肖笑携", "携孝", "", "小效", "", "歇", "携小孝鞋", "",
"笑携", "小小孝鞋", "小孝", "啸小孝鞋", "小小孝", "孝小孝鞋", "", "携孝", "小校孝小孝", "小孝", "校小孝", "小孝鞋",
"小小小孝鞋", "孝孝校", "校小孝孝", "协小孝"]
        };
        const foundColors = [ { bg: '#f39c12' }, { bg: '#2ecc71' }, { bg: '#3498db' }, { bg: '#9b59b6' }, { bg: '#e74c3c' }, { bg: '#1abc9c' }, { bg: '#f1c40f' }, { bg: '#27ae60' }, { bg: '#2980b9' }, { bg: '#8e44ad' } ];
        const state = { gridSize: 0, words: [], wordCellCoords: new Map(), grid: [], foundWords: [], isSelecting: false, selectedCells: [], hintedWord: null, hintedLetterIndex: 0, };
        const dom = { mainMenu: document.getElementById('main-menu'), gameScreen: document.getElementById('game-screen'), gridContainer: document.getElementById('grid-container'), levelDisplay: document.getElementById('level-display'), themeToggle: document.getElementById('theme-toggle'), winModal: document.getElementById('win-modal'), pauseModal: document.getElementById('pause-modal'), rulesModal: document.getElementById('rules-modal'), pauseButton: document.getElementById('pause-button'), hintButton: document.getElementById('hint-button'), nextLevelButton: document.getElementById('next-level-button'), resumeButton: document.getElementById('resume-button'), winMenuButton: document.getElementById('win-menu-button'), pauseMenuButton: document.getElementById('pause-menu-button'), rulesButton: document.getElementById('rules-button'), closeRulesButton: document.getElementById('close-rules-button'), };

        // ---  孝笑 OK SDK ---
        async function saveGameData() {
            if (!FAPI) return;
            const dataToSave = JSON.stringify(gameState);
            FAPI.Client.setVars('fillwords_save', dataToSave);
        }

        function loadGameData() {
            return new Promise((resolve) => {
                if (!FAPI) { resolve(); return; }
                FAPI.Client.getVars('fillwords_save', (status, data) => {
                    if (status === 'ok' && data && data.length > 0) {
                        try {
                            const loadedData = JSON.parse(data[0].value);
                            gameState.theme = loadedData.theme || 'light';
                            gameState.levels = { ...gameState.levels, ...loadedData.levels };
                        } catch(e) { console.error('Error parsing save data', e); }
                    }
                    resolve();
                });
            });
        }
        
        function showInterstitialAd() {
            if (!FAPI) return;
            levelsPlayedSinceAd++;
            if (levelsPlayedSinceAd >= INTERSTITIAL_AD_FREQUENCY) {
                FAPI.UI.showAd();
                levelsPlayedSinceAd = 0;
            }
        }

        
        function initGameUI() {
            document.body.dataset.theme = gameState.theme;
            updateMainMenu();
            setupEventListeners();
        }

        function setupEventListeners() {
            document.querySelectorAll('.menu-button').forEach(b => b.addEventListener('click', () => startGame(parseInt(b.dataset.size))));
            dom.themeToggle.addEventListener('click', toggleTheme);
            dom.pauseButton.addEventListener('click', () => showModal(dom.pauseModal));
            dom.resumeButton.addEventListener('click', () => hideModal(dom.pauseModal));
            dom.winMenuButton.addEventListener('click', showMainMenu);
            dom.pauseMenuButton.addEventListener('click', showMainMenu);
            dom.hintButton.addEventListener('click', handleHintClick);
            dom.nextLevelButton.addEventListener('click', nextLevel);
            dom.rulesButton.addEventListener('click', () => showModal(dom.rulesModal));
            dom.closeRulesButton.addEventListener('click', () => hideModal(dom.rulesModal));
            dom.gridContainer.addEventListener('mousedown', handleMouseDown);
            dom.gridContainer.addEventListener('touchstart', handleTouchStart, { passive: false });
            document.addEventListener('gesturestart', e => e.preventDefault());
            document.addEventListener('contextmenu', event => event.preventDefault());
        }

        function updateMainMenu() {
            const gridSizes = [5, 6, 7, 8];
            gridSizes.forEach((size, index) => {
                const level = gameState.levels[size] || 1;
                document.getElementById(`level-info-${size}`).textContent = `校芯胁械薪: ${level}`;
                const button = document.querySelector(`.menu-button[data-size="${size}"]`);
                if (index > 0) {
                    const prevLevel = gameState.levels[gridSizes[index - 1]] || 1;
                    const isLocked = prevLevel < LEVELS_TO_UNLOCK;
                    button.disabled = isLocked;
                    button.classList.toggle('locked', isLocked);
                    if (isLocked) document.getElementById(`unlock-progress-${size}`).textContent = `${prevLevel} / ${LEVELS_TO_UNLOCK}`;
                }
            });
        }
        
        function toggleTheme() {
            gameState.theme = document.body.dataset.theme === 'light' ? 'dark' : 'light';
            document.body.dataset.theme = gameState.theme;
            saveGameData();
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            if (screenId === 'game-screen') {
                window.addEventListener('mousemove', handleMouseMove); window.addEventListener('mouseup', handleMouseUp);
                window.addEventListener('touchmove', handleTouchMove, { passive: false }); window.addEventListener('touchend', handleTouchEnd);
            } else {
                window.removeEventListener('mousemove', handleMouseMove); window.removeEventListener('mouseup', handleMouseUp);
                window.removeEventListener('touchmove', handleTouchMove); window.removeEventListener('touchend', handleTouchEnd);
            }
        }
        
        function startGame(size) {
            const button = document.querySelector(`.menu-button[data-size="${size}"]`);
            if (button.disabled) return;
            state.gridSize = size;
            showScreen('game-screen');
            generateLevel();
        }

        function showMainMenu() {
            hideModal(dom.winModal); hideModal(dom.pauseModal);
            showScreen('main-menu');
            updateMainMenu();
        }

        async function nextLevel() {
            hideModal(dom.winModal);
            gameState.levels[state.gridSize]++;
            await saveGameData();
            showInterstitialAd();
            generateLevel();
        }

        function generateLevel() {
            resetStateForNewLevel();
            dom.levelDisplay.textContent = `校芯胁械薪 ${gameState.levels[state.gridSize]}`;
            const requiredArea = state.gridSize * state.gridSize;
            state.words = findWordCombination(requiredArea);
            if (!state.words) { showToast("懈斜泻邪 锌芯写斜芯邪 谢芯胁. 芯锌芯斜泄械 薪芯胁邪."); showMainMenu(); return; }
            let success = false; let attempts = 0;
            while(!success && attempts++ < 200) { state.grid = createEmptyGrid(); state.wordCellCoords.clear(); success = placeWordsOnGrid(); }
            if(!success) { showToast("懈斜泻邪 谐械薪械邪懈懈 芯胁薪. 芯卸邪谢泄邪, 胁械薪懈械 胁 屑械薪."); showMainMenu(); return; }
            renderGrid();
        }
        
        const showModal = (modal) => modal.classList.add('active');
        const hideModal = (modal) => modal.classList.remove('active');
        const resetStateForNewLevel = () => { Object.assign(state, { foundWords: [], selectedCells: [], hintedWord: null, hintedLetterIndex: 0 }); dom.gridContainer.innerHTML = ''; };
        const findWordCombination = (targetSum) => { const allWords = Object.values(wordsDB).flat().map(w => w.toLowerCase()); const uniqueWords = [...new Set(allWords)]; uniqueWords.sort(() => Math.random() - 0.5); let result = null; function backtrack(startIndex, currentSum, combination) { if (result) return; if (currentSum === targetSum) { result = [...combination]; return; } if (currentSum > targetSum || startIndex === uniqueWords.length) return; const word = uniqueWords[startIndex]; combination.push(word); backtrack(startIndex + 1, currentSum + word.length, combination); if (result) return; combination.pop(); backtrack(startIndex + 1, currentSum, combination); } backtrack(0, 0, []); return result; };
        const createEmptyGrid = () => Array.from({ length: state.gridSize }, () => Array(state.gridSize).fill(null));
        function placeWordsOnGrid() { const sortedWords = [...state.words].sort((a, b) => b.length - a.length); for (const word of sortedWords) { let placed = false; for (let i = 0; i < 150; i++) { const path = findPathForWord(word.length); if (path) { state.wordCellCoords.set(word, path); path.forEach((pos, j) => { state.grid[pos.r][pos.c] = word[j]; }); placed = true; break; } } if (!placed) return false; } return true; }
        function findPathForWord(length) { const startR = Math.floor(Math.random() * state.gridSize), startC = Math.floor(Math.random() * state.gridSize); const path = []; function backtrack(r, c) { if (path.length === length) return true; if (r < 0 || r >= state.gridSize || c < 0 || c >= state.gridSize || state.grid[r][c] !== null) return false; path.push({ r, c }); state.grid[r][c] = 'temp'; const directions = [[-1, 0], [1, 0], [0, -1], [0, 1]].sort(() => Math.random() - 0.5); for (const [dr, dc] of directions) { if (backtrack(r + dr, c + dc)) { state.grid[r][c] = null; return true; } } path.pop(); state.grid[r][c] = null; return false; } return backtrack(startR, startC) ? path : null; }
        function renderGrid() { dom.gridContainer.innerHTML = ''; dom.gridContainer.style.gridTemplateColumns = `repeat(${state.gridSize}, 1fr)`; state.grid.forEach((row, r) => { row.forEach((letter, c) => { const cell = document.createElement('div'); cell.className = 'grid-cell'; cell.dataset.r = r; cell.dataset.c = c; cell.textContent = letter; dom.gridContainer.appendChild(cell); }); }); }
        const getCellFromCoords = ({ clientX, clientY }) => document.elementFromPoint(clientX, clientY);
        function startSelection(target) { const cell = target.closest('.grid-cell'); if (cell && !cell.classList.contains('found')) { state.isSelecting = true; addCellToSelection(cell); } }
        function moveSelection(target) { if (!state.isSelecting) return; const cell = target.closest('.grid-cell'); if (cell && !cell.classList.contains('found')) addCellToSelection(cell); }
        function endSelection() { if (state.isSelecting) { state.isSelecting = false; checkSelectedWord(); } }
        const handleMouseDown = (e) => startSelection(e.target);
        const handleMouseMove = (e) => moveSelection(e.target);
        const handleMouseUp = () => endSelection();
        const handleTouchStart = (e) => { e.preventDefault(); startSelection(getCellFromCoords(e.touches[0])); };
        const handleTouchMove = (e) => { e.preventDefault(); moveSelection(getCellFromCoords(e.touches[0])); };
        const handleTouchEnd = () => endSelection();
        function addCellToSelection(cellEl) { const r = parseInt(cellEl.dataset.r), c = parseInt(cellEl.dataset.c); if (state.selectedCells.some(cell => cell.r === r && cell.c === c)) return; const lastCell = state.selectedCells[state.selectedCells.length - 1]; if (lastCell && Math.abs(lastCell.r - r) + Math.abs(lastCell.c - c) !== 1) return; state.selectedCells.push({r, c}); updateSelectionLook(); }
        function checkSelectedWord() { if (state.selectedCells.length === 0) return; const selectedWordStr = state.selectedCells.map(({r, c}) => state.grid[r][c]).join(''); const wordData = state.words.find(w => w === selectedWordStr.toLowerCase()); if (wordData && !state.foundWords.includes(wordData)) { if (wordData === state.hintedWord) clearHint(); state.foundWords.push(wordData); markWordAsFound(wordData); if (state.foundWords.length === state.words.length) setTimeout(() => showModal(dom.winModal), 500); } state.selectedCells = []; updateSelectionLook(); }
        const updateSelectionLook = () => { document.querySelectorAll('.grid-cell.selected').forEach(c => c.classList.remove('selected')); state.selectedCells.forEach(({r, c}) => { const cellEl = document.querySelector(`.grid-cell[data-r='${r}'][data-c='${c}']`); if(cellEl) cellEl.classList.add('selected'); }); };
        function markWordAsFound(word) { const colorIndex = (state.foundWords.length - 1) % foundColors.length; const color = foundColors[colorIndex]; const coords = state.wordCellCoords.get(word); coords.forEach(({r, c}) => { const cellEl = document.querySelector(`.grid-cell[data-r='${r}'][data-c='${c}']`); if (cellEl) { cellEl.classList.add('found'); cellEl.style.backgroundColor = color.bg; cellEl.style.color = '#ffffff'; } }); }
        
function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast-notification';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => { toast.classList.add('show'); }, 10);
            setTimeout(() => { toast.classList.remove('show'); toast.addEventListener('transitionend', () => toast.remove()); }, 3000);
        }

        function handleHintClick() {
            if (!FAPI) return showToast('懈斜泻邪: SDK 薪械 蟹邪谐卸械薪');
            // 校邪薪邪胁谢懈胁邪械屑 芯斜邪斜芯懈泻 械蟹谢邪邪 *锌械械写* 锌芯泻邪蟹芯屑 械泻谢邪屑
            FAPI.addCallback('sdk.showExtAdResult', (status) => {
                if (status === 'ok') {
                    grantHint();
                } else {
                    showToast('芯屑芯懈械 械泻谢邪屑 写芯 泻芯薪邪');
                }
                // 校写邪谢械屑 芯斜邪斜芯懈泻, 芯斜 芯薪 薪械 邪斜芯邪谢 锌芯胁芯薪芯
                FAPI.removeCallback('sdk.showExtAdResult');
            });
            FAPI.UI.showLoadedExtAd();
        }

        function grantHint() {
            if (!state.hintedWord) {
                const unfoundWords = state.words.filter(w => !state.foundWords.includes(w));
                if (unfoundWords.length === 0) { showToast('械 谢芯胁邪 薪邪泄写械薪!'); return; }
                state.hintedWord = unfoundWords[Math.floor(Math.random() * unfoundWords.length)];
                state.hintedLetterIndex = 0;
            }
            if (state.hintedLetterIndex >= state.hintedWord.length) { showToast('械 斜泻胁 芯谐芯 谢芯胁邪 卸械 锌芯写泻邪蟹邪薪'); return; }
            state.hintedLetterIndex++;
            const coords = state.wordCellCoords.get(state.hintedWord);
            const cellsToAnimate = [];
            for (let i = 0; i < state.hintedLetterIndex; i++) {
                const cellEl = document.querySelector(`.grid-cell[data-r='${coords[i].r}'][data-c='${coords[i].c}']`);
                if (cellEl) cellsToAnimate.push(cellEl);
            }
            document.querySelectorAll('.grid-cell.hint').forEach(cell => cell.classList.remove('hint'));
            setTimeout(() => cellsToAnimate.forEach(cell => cell.classList.add('hint')), 10);
        }
        const clearHint = () => { state.hintedWord = null; state.hintedLetterIndex = 0; document.querySelectorAll('.grid-cell.hint').forEach(cell => cell.classList.remove('hint')); };

        // --- 蝎 校小 ---
        FAPI_PARAMS = await initOKSDK();
        await loadGameData();
        initGameUI();

    });
    </script>
</body>
</html>

